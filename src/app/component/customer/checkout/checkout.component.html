<div class="checkout-container">
  <!-- 店家分組訂單 -->
  <ng-container *ngFor="let storeOrder of (checkoutService.orderData$ | async)?.store_orders">
    <div class="store-order-container">
      <!-- 店家資訊 -->
      <div class="store-header">
        <span class="store-id">Store ID: {{ storeOrder.store_id }}</span>
      </div>

      <!-- 商品列表 -->
      <div class="store-products">
        <ng-container *ngFor="let product of storeOrder.product_variants">
          <div class="product-item">
            <!-- 商品名稱與 ID -->
            <div class="product-name">Product ID: {{ product.product_variant_id }}</div>

            <!-- 數量調整 -->
            <div class="product-quantity">
              <label for="quantity-{{ product.product_variant_id }}">Quantity:</label>
              <input
                id="quantity-{{ product.product_variant_id }}"
                type="number"
                [(ngModel)]="product.quantity"
                min="1"
                (change)="cartService.updateQuantity(product)"
                class="quantity-input"
              />
            </div>

            <!-- 商品總價 -->
            <div class="product-price">
              {{ product.quantity * (cartService.getCartItemUsingProductId(product.product_variant_id).price || 0)| currency }}
            </div>

            <!-- 刪除按鈕 -->
            <button class="delete-button" (click)="cartService.removeItemUsingProductId(product)">
              Delete
            </button>
          </div>
        </ng-container>
      </div>

      <!-- 店家折扣區域 -->
      <div class="store-discounts">
        <!-- 季節優惠碼 -->
        <div class="discount-input">
          <label for="seasonal-{{ storeOrder.store_id }}">Seasonal Discount:</label>
          <input
            id="seasonal-{{ storeOrder.store_id }}"
            type="text"
            [(ngModel)]="storeOrder.seasonal_discount_code"
            (blur)="checkoutService.applyDiscount(storeOrder.seasonal_discount_code, 'store_order', storeOrder.store_id)"
            placeholder="Enter Seasonal Discount"
          />
        </div>

        <!-- 特殊優惠碼 -->
        <div class="discount-input">
          <label for="special-{{ storeOrder.store_id }}">Special Discount:</label>
          <input
            id="special-{{ storeOrder.store_id }}"
            type="text"
            [(ngModel)]="storeOrder.special_discount_code"
            (blur)="checkoutService.applyDiscount(storeOrder.special_discount_code, 'store_order', storeOrder.store_id)"
            placeholder="Enter Special Discount"
          />
        </div>
      </div>
    </div>
  </ng-container>

  <!-- 訂單總結 -->
  <div class="order-summary">
    <div class="summary-row">
      <span>Total Products:</span>
      <span>{{ totalAmount | currency }}</span>
    </div>

    <div class="summary-row">
      <span>Shipping Discount:</span>
      <input
        type="text"
        placeholder="Enter Shipping Discount Code"
        [(ngModel)]="shippingDiscountCode"
        (blur)="checkoutService.applyDiscount(shippingDiscountCode, 'order')"
      />
    </div>

    <div class="summary-row">
      <span>Final Total:</span>
      <span>{{ totalAmount | currency }}</span>
    </div>

    <!-- 確認與提交按鈕 -->
    <button class="submit-order-button" (click)="submitOrder()">Confirm and Submit</button>
  </div>
</div>
