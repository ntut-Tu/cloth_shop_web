<div class="checkout-container">
  <!-- 店家分組訂單 -->
  <ng-container *ngFor="let storeOrder of (checkoutService.orderData$ | async)?.store_orders">
    <div class="store-order-container">
      <!-- 店家資訊 -->
      <div class="store-header">
        <span class="store-id">Store ID: {{ storeOrder.store_id }}</span>
      </div>

      <!-- 商品列表 -->
      <div class="store-products">
        <ng-container *ngFor="let product of storeOrder.product_variants">
          <div class="product-item">
            <div class="product-name">Product ID: {{ product.product_variant_id }}</div>
            <div class="product-quantity">
              <label for="quantity-{{ product.product_variant_id }}">Quantity:</label>
              <input
                id="quantity-{{ product.product_variant_id }}"
                type="number"
                [(ngModel)]="product.quantity"
                min="1"
                (change)="cartService.updateQuantity(product)"
                class="quantity-input"
              />
            </div>
            <div class="product-price">
              {{ product.quantity * (cartService.getCartItemUsingProductId(product.product_variant_id).price || 0) | currency }}
            </div>
            <button class="delete-button" (click)="cartService.removeItemUsingProductId(product)">Delete</button>
          </div>
        </ng-container>
      </div>

      <!-- 店家折扣區域 -->
      <div class="store-discounts">
        <!-- 如果已應用優惠 -->
        <div *ngIf="storeOrder.special_discount_code || storeOrder.seasonal_discount_code">
          <span>Current Discount:
            {{ storeOrder.special_discount_code || storeOrder.seasonal_discount_code }}
          </span>
        </div>

        <!-- 如果尚未應用優惠 -->
        <div *ngIf="!(storeOrder.special_discount_code || storeOrder.seasonal_discount_code)">
          <div class="discount-input">
            <label for="discount-{{ storeOrder.store_id }}">Store Discount:</label>
            <input
              id="discount-{{ storeOrder.store_id }}"
              type="text"
              [(ngModel)]="storeOrder.tempDiscountCode"
              placeholder="Enter Discount Code"
            />
            <button
              class="apply-discount-button"
              (click)="applyStoreDiscount(storeOrder.tempDiscountCode||'', storeOrder.store_id)"
            >
              Apply Discount
            </button>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- 訂單總結 -->
  <div class="order-summary">
    <div class="summary-row">
      <span>Total Products:</span>
      <span>{{ totalAmount | currency }}</span>
    </div>

    <div class="summary-row">
      <span>Shipping Discount:</span>
      <div>
        <input
          type="text"
          placeholder="Enter Shipping Discount Code"
          [(ngModel)]="shippingDiscountCode"
        />
        <button (click)="applyOrderDiscount(shippingDiscountCode)">Apply Discount</button>
      </div>
    </div>

    <div class="summary-row">
      <span>Final Total:</span>
      <span>{{ totalAmount | currency }}</span>
    </div>

    <button class="submit-order-button" (click)="submitOrder()">Confirm and Submit</button>
  </div>
</div>
